<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="es" dir="ltr">

<head>
	<meta http-equiv="Content-Type" content="text/html charset=iso-8859-1">
	<title>Editar carrito</title>
	<script language="javascript">

		const itemName = [
			'Ultra Widget',
			'Deluxe Widget',
			'Red Widget',
			'Kaltrops',
			'Shuriken',
			'Mask'
		]

		const itemPrice = [12.0, 25.0, 20.0, 10.0, 15.0, 12.5]

		const shipping = [2.0, 3.0, 2.0, 5.8, 5.5, 6.0, 1.0]

		let itemNumber = []

		if (document.cookie) {
			processCookie()
		}

		function processCookie() {
			const wholeCookie = unescape(document.cookie)
			const dropName = wholeCookie.split('=')
			if (dropName[1]) {
				itemNumber = dropName[1].split('xxx')
				alert(itemNumber)
			}
		}

		function killCookies() {
			const killDate = new Date('January 1, 1970')
			document.cookie = `stuff=stub;expires=${killDate.toGMTString()}`
			window.location = 'pagina2.htm'
		}

		function remove() {
			let newCookieRawData = 'drop this'

			let orderboxes = document.orderform.orderboxes
			if (orderboxes) {
				// Para que el forEach funcione, orderboxes debe ser un NodeList o un arreglo
				orderboxes = orderboxes instanceof RadioNodeList ? orderboxes : [orderboxes]
				orderboxes.forEach(orderbox => {
					newCookieRawData += orderbox.checked ? '' : `${orderbox.value}xxx`
				});
			}

			var dropInitialization = newCookieRawData.split('drop this')
			if (!dropInitialization[1]) {
				killCookies()
			}
			else {
				var cleanData = dropInitialization[1]
				document.cookie = `stuff=${escape(cleanData)}`
			}

			window.location = 'pagina2.htm'
		}
	</script>
</head>

<body>
	<h4>Esta es la lista de productos que has ordenado. Para elimina los elementos marcalos y haz clic al boton de
		remover.</h4>
	<p>
		<form name="orderform">
			<script language="JavaScript">
				if (itemNumber.length < 1) {
					document.write('<h4>No hay elementos en el carrito. Agrega algunos utilizando el enlace</h4>')
				}
				else {
					let total = 0

					const last = itemNumber.pop()
					itemNumber.forEach(value => {
						document.write(`<input type="checkbox" name="orderboxes" value="${value}">`)
						document.write(`<b>${itemName[value]}</b> &nbsp;&nbsp;`)
						document.write(`<i>precio: $${itemPrice[value]}</i> &nbsp;&nbsp;`)
						document.write(`env√≠o: $${shipping[value]}<br><br>`)

						total += itemPrice[value] + shipping[value]
					})
					itemNumber.push(last)

					document.write(`Total - $${total}`)
				}
			</script>
			<br><br>
			<input type="button" onclick="remove()" value="Eliminar">
	</p>
	</form>
	<p>
		<a href="pagina1.htm">Agregar productos</a>&nbsp;&nbsp;
		<a href="javascript:killCookies()">Vaciar carrito</a>
	</p>Enviar datos a otra <a href="pagina3.htm?nombre=victor">forma</a>
</body>

</html>