<!DOCTYPE html>
<html lang="es" dir="ltr">

<head>
  <meta charset="utf-8">
  <link href="estilos.css" rel="stylesheet" type="text/css" />
  <title>Agregar actividad</title>
  <script src="madmurphy-cookies.js"></script> <!-- Simple cookie library -->
  <script src="Pendiente.js"></script> <!-- Pendiente's class -->

  <script language="javascript">
/* global docCookies, Pendiente*/

function formatDate (date) {
  date = date.replace(/-/gi, '')
  if (date.length !== 8) {
    return {}
  }

  try {
    const day = Number(date.substring(0, 2))
    const month = Number(date.substring(2, 4))
    const year = Number(date.substring(4, 8))
    if (year >= new Date().getFullYear() &&
      day <= 31 && day > 0 &&
      month <= 12 && month > 0) {
      return { day, month, year }
    }
  }
  catch (error) {}
  return {}
}

window.onload = () => {
  const pendientes = docCookies.hasItem('pendientes') ? JSON.parse(docCookies.getItem('pendientes')) : []

  document.getElementById('agregar').onclick = () => {
    const { titulo, fecha, descripcion, duracion } = document.getElementById('form1')
    if (!titulo.value) {
      alert('Título no válido')
      titulo.focus()
      return false
    }
    const { day, month, year } = formatDate(fecha.value)
    if (!year) {
      alert('Fecha no válida')
      fecha.focus()
      return false
    }
    if (!duracion.value) {
      alert('Debe seeccionar la duración')
      return false
    }
    pendientes.push(new Pendiente(titulo.value, `${day}-${month}-${year}`, descripcion.value))
    docCookies.removeItem('pendientes')
    docCookies.setItem('pendientes', JSON.stringify(pendientes))
    window.opener.postMessage('agregado', '*')
  }
}
  </script>
</head>

<body>
  <h1 class="titulo">Agregar actividad.</h1>
  <form id="form1" name="form1" method="post" action="">
    <table>
      <tr>
        <td>Titulo:</td>
        <td><input type="text" name="titulo" id="titulo" /></td>
      </tr>
      <tr>
        <td>Fecha:</td>
        <td>
          <input type="text" name="fecha" id="fecha" />
          (dd-mm-aaaa)
        </td>
      </tr>
      <tr>
        <td>Descripción</td>
        <td><textarea name="descripcion" id="descripcion" cols="45" rows="5"></textarea></td>
      </tr>
      <tr>
        <td>Duración:</td>
        <td>
          <p>
            <input
              type="radio"
              name="duracion"
              id="radio"
              value="15"
            />
            15 minutos<br>
            <input
              type="radio"
              name="duracion"
              id="radio2"
              value="30"
            />
            30 minutos<br>
            <input
              type="radio"
              name="duracion"
              id="radio3"
              value="1"
            />
            1 hora<br>
            <input
              type="radio"
              name="duracion"
              id="radio4"
              value="-1"
            />
            Más de 1 hora
          </p>
        </td>
      </tr>
      <tr>
        <td colspan="2"><input type="button" name="agregar" id="agregar" value="Agregar" />
          <input type="button" name="cerrar" id="cerrar" value="Cerrar" onclick="window.close()" /></td>
      </tr>
    </table>
  </form>
  <p>&nbsp;</p>
</body>

</html>